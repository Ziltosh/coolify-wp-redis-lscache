services:
    mysql:
        image: mariadb:11.4
        logging:
            driver: none
        command: ['--max-allowed-packet=512M']
        volumes:
            - './data/db:/var/lib/mysql:delegated'
        environment:
            MYSQL_ROOT_PASSWORD: ${SERVICE_PASSWORD_MYSQLROOT:-root}
            MYSQL_DATABASE: wordpress
            MYSQL_USER: ${SERVICE_USER_MYSQL:-user}
            MYSQL_PASSWORD: ${SERVICE_PASSWORD_MYSQL:-password}

    litespeed:
        image: litespeedtech/openlitespeed:${OLS_VERSION}-${PHP_VERSION}
        container_name: litespeed
        env_file:
            - .env
        volumes:
            - ./lsws/conf:/usr/local/lsws/conf
            - ./lsws/admin-conf:/usr/local/lsws/admin/conf
            - ./bin/container:/usr/local/bin
            - ./sites:/var/www/vhosts/
            - ./acme:/root/.acme.sh/
            - ./logs:/usr/local/lsws/logs/
        ports:
            - 80
            - 443
            - 443/udp
        environment:
            TZ: ${TZ:-Europe/Paris}

    redis:
        image: 'redis:latest'
        restart: 'always'
        ports:
            - 6379
        healthcheck:
            test: ['CMD', 'redis-cli', '--raw', 'incr', 'ping']
            interval: 10s
            timeout: 10s
            retries: 10
